const fs = require('fs');
const path = require('path');

// Read theme.json from parent directory (theme root)
const themeData = require('../theme.json');

// Extract color palette from theme.json
const colorPalette = themeData.settings.color.palette;

// Generate color utility classes
let scssContent = '// Auto-generated color utilities from theme.json\n';
scssContent += '// This file is generated by src/generate-colors.js\n\n';

// CSS Custom Properties (simpler --color-{slug} variables)
scssContent += ':root {\n';
colorPalette.forEach(colorItem => {
    scssContent += `  --color-${colorItem.slug}: ${colorItem.color};\n`;
});
scssContent += '}\n\n';

// Background classes with --bg-color variable for inheritance
scssContent += '// Background color utilities\n';
colorPalette.forEach(colorItem => {
    scssContent += `.bg-${colorItem.slug} {\n`;
    scssContent += `  --bg-color: var(--color-${colorItem.slug});\n`;
    scssContent += `  background-color: var(--bg-color);\n`;
    scssContent += `}\n\n`;
});

// Text color classes with --text-color variable for inheritance
scssContent += '// Text color utilities\n';
colorPalette.forEach(colorItem => {
    scssContent += `.text-${colorItem.slug} {\n`;
    scssContent += `  --text-color: var(--color-${colorItem.slug});\n`;
    scssContent += `  color: var(--text-color);\n`;
    scssContent += `}\n\n`;
});

// Border color classes
scssContent += '// Border color utilities\n';
colorPalette.forEach(colorItem => {
    scssContent += `.border-${colorItem.slug} {\n`;
    scssContent += `  border-color: var(--color-${colorItem.slug});\n`;
    scssContent += `}\n\n`;
});

// WordPress compatibility classes (what WP would generate, but without !important)
scssContent += '// WordPress color class compatibility (without !important)\n';
colorPalette.forEach(colorItem => {
    scssContent += `.has-${colorItem.slug}-color {\n`;
    scssContent += `  --text-color: var(--color-${colorItem.slug});\n`;
    scssContent += `  color: var(--text-color);\n`;
    scssContent += `}\n\n`;
    
    scssContent += `.has-${colorItem.slug}-background-color {\n`;
    scssContent += `  --bg-color: var(--color-${colorItem.slug}, inherit);\n`;
    scssContent += `  background-color: var(--bg-color);\n`;
    scssContent += `}\n\n`;
});

// Write the utilities file to src directory
fs.writeFileSync(
    path.join(__dirname, '_color-utilities.scss'),
    scssContent
);

console.log('âœ… Generated src/_color-utilities.scss from theme.json');
console.log(`   Created ${colorPalette.length} color utilities`);